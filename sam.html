<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Buy Panel - WinZone</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://kit.fontawesome.com/dd6d3987dd.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512-..." crossorigin="anonymous" referrerpolicy="no-referrer" />

  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      background: #f7fafc;
      color: #2d3748;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    nav.top-nav {
      background: linear-gradient(to bottom, #002b5c, #004080);
      color: white;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 40px;
      position: sticky;
      top: 0;
      z-index: 110;
      font-weight: 600;
      font-size: 20px;
      letter-spacing: 0.03em;
      text-transform: uppercase;
      user-select: none;
      box-shadow: none;
    }

    nav.top-nav h2 {
      margin: 0;
      color: #e2e8f0;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    nav.top-nav button.back-btn {
      background-color: transparent;
      color: #e2e8f0;
      padding: 8px 20px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s ease, color 0.3s ease, transform 0.2s ease;
      font-size: 50px;
      position: absolute;
      right: 30px;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    nav.top-nav button.back-btn:hover {
      background-color: #e2e8f0;
      color: #2c3e50;
      transform: translateY(-50%) scale(1.05);
    }

    nav.top-nav button.back-btn i {
      font-size: 30px;
    }

    h2 {
      text-align: center;
      font-weight: 700;
      color: #2d3748;
      margin-bottom: 0px;
      font-size: 28px;
    }

    .tabs {
      display: flex;
      background: white;
      overflow: hidden;
      margin: 0;
      box-shadow: none;
      border-radius: 0;
    }

    .tab {
      position: relative;
      flex: 1;
      text-align: center;
      padding: 18px 0;
      cursor: pointer;
      color: #45617e;
      font-weight: 600;
      font-size: 16px;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      background: transparent;
    }

    .tab::after {
      content: "";
      position: absolute;
      bottom: 0;
      left: 50%;
      width: 0;
      height: 3px;
      background-color: transparent;
      transition: width 0.3s ease, background-color 0.3s ease;
      transform: translateX(-50%);
    }

    .tab:hover::after {
      background-color: #002b5c;
      width: 100%;
    }

    .tab.active::after {
      background-color: #4c4baf;
      width: 100%;
    }

    .tab:hover {
      background: transparent;
      color: #002b5c;
    }

    .tab.active {
      background: transparent;
      color: #002b5c;
      font-weight: 700;
    }

    .tab-content {
      display: none;
      background: white;
      padding: 30px 40px;
      border-radius: 16px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.07);
      min-height: 350px;
    }

    .tab-content.active {
      display: block;
      animation: fadeIn 0.4s ease-in-out;
    }

    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 20px;
    }

    .form-row input,
    .form-row select {
      flex: 1 1 200px;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 15px;
      transition: border-color 0.3s;
    }

    .form-row input:focus,
    .form-row select:focus {
      border-color: #00b894;
      outline: none;
    }

    button {
      background: #1e3c72;
      border: none;
      padding: 12px 20px;
      color: white;
      font-weight: bold;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s;
    }

    button:hover {
      background: #1e3c72;
    }

    .product-card {
      padding: 15px;
      background: #ffffff;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
      margin-bottom: 15px;
      transition: transform 0.2s ease;
    }

    .product-card:hover {
      transform: scale(1.01);
    }

    .product-card h4 {
      margin: 0 0 8px;
      color: #2d3436;
    }

    .restock-btn {
      background: #e67e22;
      margin-top: 10px;
      font-size: 14px;
      padding: 8px 14px;
    }

    /* Mobile Responsive Styles */
    @media (max-width: 600px) {
      body {
        padding: 10px;
      }

      nav.top-nav {
        justify-content: flex-start;
        padding: 0 15px;
      }

      nav.top-nav h2 {
        margin-right: auto;
        font-size: 18px;
      }

      nav.top-nav button.back-btn {
        width: 36px;
        height: 36px;
        border-radius: 70%;
        background: transparent;
        border: none;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 0;
        transition: background-color 0.2s ease;
        flex-shrink: 0;
      }

      nav.top-nav button.back-btn i {
        font-size: 18px;
        color: #fff;
      }

      nav.top-nav button.back-btn:hover {
        background-color: #606697;
        color: #21314e;
      }

      .tabs {
        flex-direction: column;
      }

      .tab {
        padding: 12px 10px;
        font-size: 14px;
      }

      .form-row {
        flex-direction: column;
      }

      .form-row input,
      .form-row select {
        flex: 1 1 100%;
        padding: 10px;
        font-size: 14px;
      }

      button {
        width: 100%;
        padding: 12px 0;
        font-size: 16px;
      }

      table {
        font-size: 13px;
      }

      table th,
      table td {
        padding: 8px 6px;
      }

      /* Make action buttons smaller */
      table button {
        padding: 4px 8px;
        font-size: 12px;
      }

      /* Prevent horizontal scroll on tables */
      #currentStockList,
      #outOfStockList {
        overflow-x: auto;
      }
    }
  </style>
</head>
<body>
<nav class="top-nav" role="banner">
    <a href="admin2.html"><button class="back-btn"><i class="fa-solid fa-home"></i></button></a>
    <h2><i class="fas fa-box"></i> Inventory </h2>
</nav>
<div class="container"></div>
<div class="tabs">
  <div class="tab active" onclick="switchTab(0)">
    <i class="fas fa-plus"></i> Add Stock
  </div>
  <div class="tab" onclick="switchTab(1)">
    <i class="fas fa-box"></i> Current Stock
  </div>
  <div class="tab" onclick="switchTab(2)">
    <i class="fas fa-triangle-exclamation"></i> Out of Stock
  </div>
  <div class="tab" onclick="switchTab(3)">
    <i class="fas fa-shopping-cart"></i> Buy
  </div>
</div>

<!-- Add Stock Tab -->
<div class="tab-content active" id="addStockTab">
  <h3>Add Product Stock</h3>
  <div class="form-row">
    <select id="category">
      <option value="">Select Category</option>
      <option value="Electronics">Electronics</option>
      <option value="Stationery">Stationery</option>
      <option value="Household">Household</option>
    </select>
    <input type="text" id="productName" placeholder="Product Name" />
    <input type="text" id="vendorName" placeholder="Vendor Name" />
    <input type="text" id="brand" placeholder="Brand Name" />
    <input type="number" id="stockQty" placeholder="Stock Quantity" />
    <input type="number" id="price" placeholder="Price (₹)" />
    <input type="number" id="gst" placeholder="GST (%)" />
  </div>
  <button onclick="addProduct()">Add Stock</button>
</div>

<!-- Current Stock Tab -->
<div class="tab-content" id="currentStockTab">
  <h3>Available Products</h3>
  <div id="currentStockList"></div>
</div>

<!-- Out of Stock Tab -->
<div class="tab-content" id="outOfStockTab">
  <h3>Products Out of Stock</h3>
  <div style="text-align: right; margin-bottom: 15px;">
    <button onclick="downloadOutOfStock()">Download Excel</button>
  </div>
  <div id="outOfStockList"></div>
</div>

<!-- Buy Tab -->
<div class="tab-content" id="buyTab">
  <h3>Buy Products</h3>
  <div id="buyList"></div>
</div>

<script>
  let tabs = document.querySelectorAll(".tab");
  let contents = document.querySelectorAll(".tab-content");

  function switchTab(index) {
    tabs.forEach(t => t.classList.remove("active"));
    contents.forEach(c => c.classList.remove("active"));
    tabs[index].classList.add("active");
    contents[index].classList.add("active");

    if (index === 1) loadCurrentStock();
    if (index === 2) loadOutOfStock();
    if (index === 3) loadBuyProducts();
  }

  function getProducts() {
    return JSON.parse(localStorage.getItem("products") || "[]");
  }

  function saveProducts(products) {
    localStorage.setItem("products", JSON.stringify(products));
  }

  function addProduct() {
    const name = document.getElementById("productName").value.trim();
    const vendor = document.getElementById("vendorName").value.trim();
    const brand = document.getElementById("brand").value.trim();
    const category = document.getElementById("category").value;
    const stock = parseInt(document.getElementById("stockQty").value);
    const price = parseFloat(document.getElementById("price").value);
    const gst = parseFloat(document.getElementById("gst").value) || 0;

    if (!name || !vendor || !stock || !price || !category) {
      alert("Please fill all required fields.");
      return;
    }

    let products = getProducts();

    // Normalize inputs for comparison
    const nameKey = name.toLowerCase();
    const vendorKey = vendor.toLowerCase();
    const brandKey = brand.toLowerCase();
    const categoryKey = category.toLowerCase();

    // Match by name + vendor + brand + category
    let existing = products.find(
      p =>
        p.name.toLowerCase() === nameKey &&
        p.vendor.toLowerCase() === vendorKey &&
        p.brand.toLowerCase() === brandKey &&
        p.category.toLowerCase() === categoryKey
    );

    if (existing) {
      existing.stock += stock; // update stock instead of adding new
      existing.price = price;  // update price
      existing.gst = gst;      // update gst
    } else {
      products.push({ name, vendor, brand, category, stock, price, gst });
    }

    saveProducts(products);
    showNotification("Product stock added/updated!");

    // Clear inputs
    document.getElementById("productName").value = "";
    document.getElementById("vendorName").value = "";
    document.getElementById("brand").value = "";
    document.getElementById("stockQty").value = "";
    document.getElementById("price").value = "";
    document.getElementById("category").value = "";
    document.getElementById("gst").value = "";
  }

  function loadCurrentStock() {
    const list = document.getElementById("currentStockList");
    list.innerHTML = "";
    const products = getProducts().filter(p => p.stock > 0);

    if (products.length === 0) {
      list.innerHTML = "<p>No products in stock.</p>";
      return;
    }

    let tableHTML = `
      <table style="width: 100%; border-collapse: collapse; font-family: Arial, sans-serif;">
        <thead>
          <tr style="background: black; color: white;">
            <th style="padding: 10px; border: 1px solid #ddd;">Product</th>
            <th style="padding: 10px; border: 1px solid #ddd;">Category</th>
            <th style="padding: 10px; border: 1px solid #ddd;">Brand</th>
            <th style="padding: 10px; border: 1px solid #ddd;">Vendor</th>
            <th style="padding: 10px; border: 1px solid #ddd;">Stock</th>
            <th style="padding: 10px; border: 1px solid #ddd;">Price</th>
            <th style="padding: 10px; border: 1px solid #ddd;">GST</th>
            <th style="padding: 10px; border: 1px solid #ddd; text-align:center;">Action</th>
          </tr>
        </thead>
        <tbody>
    `;

    products.forEach(p => {
      tableHTML += `
        <tr>
          <td style="padding: 10px; border: 1px solid #ddd;">${p.name}</td>
          <td style="padding: 10px; border: 1px solid #ddd;">${p.category}</td>
          <td style="padding: 10px; border: 1px solid #ddd;">${p.brand}</td>
          <td style="padding: 10px; border: 1px solid #ddd;">${p.vendor}</td>
          <td style="padding: 10px; border: 1px solid #ddd;">${p.stock}</td>
          <td style="padding: 10px; border: 1px solid #ddd;">₹${p.price.toFixed(2)}</td>
          <td style="padding: 10px; border: 1px solid #ddd;">${p.gst}%</td>
          <td style="padding: 10px; border: 1px solid #ddd; text-align:center; display:flex; gap:8px; justify-content:center;">
            <button style="background:#2980b9; color:white; padding:8px 12px; border:none; border-radius:5px; cursor:pointer; font-size:18px;"
              onclick="editProduct('${p.name}', '${p.vendor}')">
              <i class="fa-solid fa-pen"></i>
            </button>
            <button style="background:#e74c3c; color:white; padding:8px 12px; border:none; border-radius:5px; cursor:pointer; font-size:18px;"
              onclick="deleteProduct('${p.name}', '${p.vendor}')">
              <i class="fa-solid fa-trash"></i>
            </button>
          </td>
        </tr>
      `;
    });

    tableHTML += `</tbody></table>`;
    list.innerHTML = tableHTML;
  }

  function loadOutOfStock() {
    const list = document.getElementById("outOfStockList");
    list.innerHTML = "";
    const products = getProducts().filter(p => p.stock === 0);

    if (products.length === 0) {
      list.innerHTML = "<p>No products are out of stock.</p>";
      return;
    }

    let tableHTML = `
    <table style="width: 100%; border-collapse: collapse; font-family: Arial, sans-serif;">
        <thead>
          <tr style="background: #9e394d; color: white;">
            <th style="padding: 10px; border: 1px solid #ddd;">Product</th>
            <th style="padding: 10px; border: 1px solid #ddd;">Category</th>
            <th style="padding: 10px; border: 1px solid #ddd;">Brand</th>
            <th style="padding: 10px; border: 1px solid #ddd;">Vendor</th>
            <th            <th style="padding: 10px; border: 1px solid #ddd;">Stock</th>
            <th style="padding: 10px; border: 1px solid #ddd;">Price</th>
            <th style="padding: 10px; border: 1px solid #ddd; text-align:center;">Action</th>
          </tr>
        </thead>
        <tbody>
    `;

    products.forEach(p => {
      tableHTML += `
        <tr>
          <td style="padding: 10px; border: 1px solid #ddd;">${p.name}</td>
          <td style="padding: 10px; border: 1px solid #ddd;">${p.category}</td>
          <td style="padding: 10px; border: 1px solid #ddd;">${p.brand}</td>
          <td style="padding: 10px; border: 1px solid #ddd;">${p.vendor}</td>
          <td style="padding: 10px; border: 1px solid #ddd;">${p.stock}</td>
          <td style="padding: 10px; border: 1px solid #ddd;">₹${p.price.toFixed(2)}</td>
          <td style="padding: 10px; border: 1px solid #ddd; text-align:center; display:flex; gap:5px; justify-content:center;">
            <button style="background:#3498db; color:white; padding:5px 10px; border:none; border-radius:5px; cursor:pointer;"
              onclick="restockProduct('${p.name}', '${p.vendor}')">
              <i class="fa-solid fa-box"></i> Restock
            </button>
          </td>
        </tr>
      `;
    });

    tableHTML += `</tbody></table>`;
    list.innerHTML = tableHTML;
  }

  function loadBuyProducts() {
    const list = document.getElementById("buyList");
    list.innerHTML = "";
    const products = getProducts().filter(p => p.stock > 0);

    if (products.length === 0) {
      list.innerHTML = "<p>No products available for purchase.</p>";
      return;
    }

    let tableHTML = `
    <table style="width: 100%; border-collapse: collapse; font-family: Arial, sans-serif;">
        <thead>
          <tr style="background: #2ecc71; color: white;">
            <th style="padding: 10px; border: 1px solid #ddd;">Product</th>
            <th style="padding: 10px; border: 1px solid #ddd;">Category</th>
            <th style="padding: 10px; border: 1px solid #ddd;">Brand</th>
            <th style="padding: 10px; border: 1px solid #ddd;">Vendor</th>
            <th style="padding: 10px; border: 1px solid #ddd;">Price</th>
            <th style="padding: 10px; border: 1px solid #ddd; text-align:center;">Action</th>
          </tr>
        </thead>
        <tbody>
    `;

    products.forEach(p => {
      tableHTML += `
        <tr>
          <td style="padding: 10px; border: 1px solid #ddd;">${p.name}</td>
          <td style="padding: 10px; border: 1px solid #ddd;">${p.category}</td>
          <td style="padding: 10px; border: 1px solid #ddd;">${p.brand}</td>
          <td style="padding: 10px; border: 1px solid #ddd;">${p.vendor}</td>
          <td style="padding: 10px; border: 1px solid #ddd;">₹${p.price.toFixed(2)}</td>
          <td style="padding: 10px; border: 1px solid #ddd; text-align:center;">
            <button style="background:#2980b9; color:white; padding:8px 12px; border:none; border-radius:5px; cursor:pointer;"
              onclick="buyProduct('${p.name}', '${p.vendor}')">
              Buy
            </button>
          </td>
        </tr>
      `;
    });

    tableHTML += `</tbody></table>`;
    list.innerHTML = tableHTML;
  }

  function buyProduct(name, vendor) {
    alert(`You have purchased ${name} from ${vendor}.`);
    // Here you can add more functionality like reducing stock, etc.
  }

  function editProduct(name, vendor) {
    const list = document.getElementById("currentStockList");
    const rows = list.querySelectorAll("tbody tr");

    rows.forEach(row => {
      const productName = row.cells[0].textContent;
      const productVendor = row.cells[3].textContent;

      if (productName === name && productVendor === vendor) {
        const priceValue = row.cells[5].textContent.replace("₹", "");
        const gstValue = row.cells[6].textContent.replace("%", "");

        row.innerHTML = `
          <td><input type="text" value="${productName}" style="width:100%;"></td>
          <td><input type="text" value="${row.cells[1].textContent}" style="width:100%;"></td>
          <td><input type="text" value="${row.cells[2].textContent}" style="width:100%;"></td>
          <td><input type="text" value="${productVendor}" style="width:100%;"></td>
          <td><input type="number" value="${row.cells[4].textContent}" style="width:100%;"></td>
          <td><input type="number" step="0.01" value="${priceValue}" style="width:100%;"></td>
          <td><input type="number" value="${gstValue}" style="width:100%;"></td>
          <td style="text-align:center; display:flex; gap:8px; justify-content:center;">
            <button style="background:green; color:white; padding:8px 12px; border:none; border-radius:5px; cursor:pointer;"
              onclick="saveEditedProduct(this, '${name}', '${vendor}')">
              <i class="fa-solid fa-check"></i>
            </button>
            <button style="background:gray; color:white; padding:8px 12px; border:none; border-radius:5px; cursor:pointer;"
              onclick="loadCurrentStock()">
              <i class="fa-solid fa-xmark"></i>
            </button>
          </td>
        `;
      }
    });
  }

  function saveEditedProduct(btn, oldName, oldVendor) {
    const row = btn.closest("tr");
    const inputs = row.querySelectorAll("input");

    const updatedProduct = {
      name: inputs[0].value,
      category: inputs[1].value,
      brand: inputs[2].value,
      vendor: inputs[3].value,
      stock: parseInt(inputs[4].value, 10),
      price: parseFloat(inputs[5].value),
      gst: parseFloat(inputs[6].value)
    };

    let products = getProducts();
    const index = products.findIndex(p => p.name === oldName && p.vendor === oldVendor);

    if (index !== -1) {
      products[index] = updatedProduct;
      saveProducts(products);
      loadCurrentStock();
    }
  }

  function deleteProduct(name, vendor) {
    if (confirm(`Are you sure you want to delete "${name}" from "${vendor}"?`)) {
      let products = getProducts().filter(
        p => !(p.name === name && p.vendor === vendor)
      );
      saveProducts(products);
      loadCurrentStock();
      showNotification(`"${name}" from "${vendor}" deleted.`, "#dc3545"); // red for delete
    }
  }

  function downloadOutOfStock() {
    const products = getProducts().filter(p => p.stock <= 0);
    if (products.length === 0) {
      alert("No out of stock products to export.");
      return;
    }

    let csv = "Product Name,Category,Brand,Vendor,GST (%)\n";
    products.forEach(p => {
      csv += `"${p.name}","${p.category}","${p.brand}","${p.vendor}",${p.gst}\n`;
    });

    const blob = new Blob([csv], { type: "text/csv" });
    const url = URL.createObjectURL(blob);
    const link = document.createElement("a");

    link.href = url;
    link.download = "OutOfStockProducts.csv";
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }

  function showNotification(message, color = "#28a745") {
    const note = document.getElementById("notification");
    note.textContent = message;
    note.style.background = color;
    note.style.display = "block";
    note.style.opacity = "1";
    
    setTimeout(() => {
      note.style.transition = "opacity 0.5s ease";
      note.style.opacity = "0";
      setTimeout(() => {
        note.style.display = "none";
        note.style.transition = "";
      }, 500);
    }, 3000);
  }

  // Handle hash changes for tab switching
  window.addEventListener("load", () => {
    const hash = window.location.hash;

    if (hash === "#outofstock") {
      switchTab(2);
    } else if (hash === "#currentstock") {
      switchTab(1);
    } else if (hash === "#buy") {
      switchTab(3);
    } else {
      switchTab(0);
    }
  });

  // Also handle hash changes when the hash changes
  window.addEventListener("hashchange", () => {
    const hash = window.location.hash;

    if (hash === "#outofstock") {
      switchTab(2);
    } else if (hash === "#currentstock") {
      switchTab(1);
    } else if (hash === "#buy") {
      switchTab(3);
    } else {
      switchTab(0);
    }
  });
</script>

<div id="notification" style="
  position: fixed;
  top: 20px;
  right: 20px;
  background: #28a745;
  color: white;
  padding: 12px 20px;
  border-radius: 6px;
  font-weight: bold;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  display: none;
  z-index: 9999;
"></div>

</body>
</html>
